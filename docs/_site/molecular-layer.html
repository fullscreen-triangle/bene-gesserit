<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Molecular Layer - Fundamental Membrane Biophysics | Bene Gesserit: Biological Quantum Computing Framework</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Molecular Layer - Fundamental Membrane Biophysics" />
<meta name="author" content="Bene Gesserit Research Team" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Revolutionary framework combining ATP dynamics, oscillatory entropy, and membrane quantum computation with Turbulance DSL for encoding the scientific method" />
<meta property="og:description" content="Revolutionary framework combining ATP dynamics, oscillatory entropy, and membrane quantum computation with Turbulance DSL for encoding the scientific method" />
<link rel="canonical" href="https://fullscreen-triangle.github.io/bene-gesserit/molecular-layer.html" />
<meta property="og:url" content="https://fullscreen-triangle.github.io/bene-gesserit/molecular-layer.html" />
<meta property="og:site_name" content="Bene Gesserit: Biological Quantum Computing Framework" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Molecular Layer - Fundamental Membrane Biophysics" />
<meta name="twitter:site" content="@bene_gesserit" />
<meta name="twitter:creator" content="@Bene Gesserit Research Team" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Bene Gesserit Research Team"},"description":"Revolutionary framework combining ATP dynamics, oscillatory entropy, and membrane quantum computation with Turbulance DSL for encoding the scientific method","headline":"Molecular Layer - Fundamental Membrane Biophysics","url":"https://fullscreen-triangle.github.io/bene-gesserit/molecular-layer.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/bene-gesserit/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://fullscreen-triangle.github.io/bene-gesserit/feed.xml" title="Bene Gesserit: Biological Quantum Computing Framework" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/bene-gesserit/">Bene Gesserit: Biological Quantum Computing Framework</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/bene-gesserit/">Bene Gesserit: Biological Quantum Computing Framework</a><a class="page-link" href="/bene-gesserit/turbulance-masterclass.html">Turbulance Masterclass: Advanced Scientific Computing</a><a class="page-link" href="/bene-gesserit/biological-maxwell-demons.html">Biological Maxwell’s Demons in the Bene Gesserit Framework</a><a class="page-link" href="/bene-gesserit/circuit-interface-layer.html">Circuit Interface Layer - Nebuchadnezzar Integration</a><a class="page-link" href="/bene-gesserit/fundamentals/advanced-mathematical-extensions.html">Advanced Mathematical Extensions: Rigorous Formalisms for Quantum Biology</a><a class="page-link" href="/bene-gesserit/fundamentals/extended-quantum-biology.html">Extended Quantum Biology: Advanced Extensions to the ATP-Oscillatory-Membrane Framework</a><a class="page-link" href="/bene-gesserit/fundamentals/membranes.html">Chapter 2: The Membrane Quantum Computation Theorem - Life as Thermodynamic Inevitability and Death as Quantum Mechanical Necessity</a><a class="page-link" href="/bene-gesserit/fundamentals/oscillations.html">Chapter 3: The Universal Oscillatory Framework - Mathematical Foundation for Causal Reality</a><a class="page-link" href="/bene-gesserit/fundamentals/quantum-extensions.html">Revolutionary Extensions to Your ATP-Oscillatory-Membrane Quantum Biology Framework</a><a class="page-link" href="/bene-gesserit/language/goal.html">Goal System in Kwasa-Kwasa</a><a class="page-link" href="/bene-gesserit/language/special_features.html">Special Language Features in Turbulance</a><a class="page-link" href="/bene-gesserit/language/turbulance-language.html">Turbulance Language Overview</a><a class="page-link" href="/bene-gesserit/molecular-layer.html">Molecular Layer - Fundamental Membrane Biophysics</a><a class="page-link" href="/bene-gesserit/orchestrator-integration.html">Orchestrator Integration</a><a class="page-link" href="/bene-gesserit/plasma-membrane.html">Plasma Membrane - The External Information Interface</a><a class="page-link" href="/bene-gesserit/quickstart-example.html">Quickstart Example - Membrane Dynamics with Nebuchadnezzar</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Molecular Layer - Fundamental Membrane Biophysics</h1>
  </header>

  <div class="post-content">
    <h1 id="molecular-layer---fundamental-membrane-biophysics">Molecular Layer - Fundamental Membrane Biophysics</h1>

<h2 id="core-philosophy">Core Philosophy</h2>

<p><strong>“Every membrane property emerges from molecular interactions - and every molecular interaction can be expressed as circuit parameters”</strong></p>

<p>The <strong>Molecular Layer</strong> implements the fundamental biophysical processes that determine membrane electrical properties. This layer translates lipid bilayer physics, protein-membrane interactions, membrane curvature dynamics, and electrochemical gradients into the circuit parameters that Nebuchadnezzar requires for ATP-based differential equations.</p>

<h2 id="lipid-bilayer-physics">Lipid Bilayer Physics</h2>

<h3 id="membrane-capacitance-calculation">Membrane Capacitance Calculation</h3>

<p>The bilayer capacitance is the most fundamental electrical property of membranes:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td><td class="rouge-code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">LipidBilayerCapacitance</span> <span class="p">{</span>
    <span class="c1">// Physical constants</span>
    <span class="n">vacuum_permittivity</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>       <span class="c1">// ε₀ = 8.854 × 10⁻¹² F/m</span>
    
    <span class="c1">// Composition-dependent properties</span>
    <span class="n">lipid_composition</span><span class="p">:</span> <span class="n">LipidComposition</span><span class="p">,</span>
    <span class="n">cholesterol_fraction</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>      <span class="c1">// 0.0 - 1.0</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>               <span class="c1">// Kelvin</span>
    
    <span class="c1">// Dynamic properties</span>
    <span class="n">membrane_thickness</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>        <span class="c1">// nm - varies with composition</span>
    <span class="n">dielectric_profile</span><span class="p">:</span> <span class="n">DielectricProfile</span><span class="p">,</span>
    
    <span class="c1">// ATP-dependent modifications</span>
    <span class="n">atp_dependent_lipid_synthesis</span><span class="p">:</span> <span class="n">AtpLipidSynthesis</span><span class="p">,</span>
    <span class="n">membrane_asymmetry</span><span class="p">:</span> <span class="n">MembraneAsymmetry</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">LipidBilayerCapacitance</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_specific_capacitance</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Multi-layer dielectric model for biological membranes</span>
        <span class="k">let</span> <span class="n">effective_permittivity</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_effective_permittivity</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">effective_thickness</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_effective_thickness</span><span class="p">();</span>
        
        <span class="k">self</span><span class="py">.vacuum_permittivity</span> <span class="o">*</span> <span class="n">effective_permittivity</span> <span class="o">/</span> <span class="p">(</span><span class="n">effective_thickness</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_effective_permittivity</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Weighted average based on lipid composition</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">effective_permittivity</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="n">lipid_type</span><span class="p">,</span> <span class="n">fraction</span><span class="p">)</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.lipid_composition.lipid_fractions</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">lipid_permittivity</span> <span class="o">=</span> <span class="k">match</span> <span class="n">lipid_type</span> <span class="p">{</span>
                <span class="nn">LipidType</span><span class="p">::</span><span class="n">PhosphatidylCholine</span> <span class="k">=&gt;</span> <span class="mf">2.3</span><span class="p">,</span>  <span class="c1">// PC headgroup</span>
                <span class="nn">LipidType</span><span class="p">::</span><span class="n">PhosphatidylSerine</span> <span class="k">=&gt;</span> <span class="mf">3.1</span><span class="p">,</span>   <span class="c1">// PS headgroup (charged)</span>
                <span class="nn">LipidType</span><span class="p">::</span><span class="n">Cholesterol</span> <span class="k">=&gt;</span> <span class="mf">2.1</span><span class="p">,</span>          <span class="c1">// Cholesterol</span>
                <span class="nn">LipidType</span><span class="p">::</span><span class="n">Sphingomyelin</span> <span class="k">=&gt;</span> <span class="mf">2.5</span><span class="p">,</span>        <span class="c1">// SM headgroup</span>
                <span class="n">_</span> <span class="k">=&gt;</span> <span class="mf">2.2</span><span class="p">,</span> <span class="c1">// Default value</span>
            <span class="p">};</span>
            <span class="n">effective_permittivity</span> <span class="o">+=</span> <span class="n">lipid_permittivity</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Temperature correction</span>
        <span class="k">let</span> <span class="n">temperature_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.002</span> <span class="o">*</span> <span class="p">(</span><span class="k">self</span><span class="py">.temperature</span> <span class="o">-</span> <span class="mf">298.0</span><span class="p">);</span> <span class="c1">// ~0.2% per K</span>
        <span class="n">effective_permittivity</span> <span class="o">*</span> <span class="n">temperature_factor</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_effective_thickness</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Bilayer thickness depends on acyl chain length and saturation</span>
        <span class="k">let</span> <span class="n">base_thickness</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_base_thickness</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">cholesterol_correction</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="k">self</span><span class="py">.cholesterol_fraction</span><span class="p">;</span> <span class="c1">// Cholesterol increases thickness</span>
        <span class="k">let</span> <span class="n">temperature_correction</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="p">(</span><span class="k">self</span><span class="py">.temperature</span> <span class="o">-</span> <span class="mf">298.0</span><span class="p">);</span> <span class="c1">// Higher T decreases thickness</span>
        
        <span class="n">base_thickness</span> <span class="o">*</span> <span class="n">cholesterol_correction</span> <span class="o">*</span> <span class="n">temperature_correction</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">update_for_atp_consumption</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">atp_consumed</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ATP consumption affects membrane through lipid synthesis</span>
        <span class="k">let</span> <span class="n">lipid_synthesis_rate</span> <span class="o">=</span> <span class="k">self</span><span class="py">.atp_dependent_lipid_synthesis</span><span class="nf">.calculate_synthesis_rate</span><span class="p">(</span><span class="n">atp_consumed</span><span class="p">);</span>
        
        <span class="c1">// Update membrane composition</span>
        <span class="k">self</span><span class="py">.lipid_composition</span><span class="nf">.update_from_synthesis</span><span class="p">(</span><span class="n">lipid_synthesis_rate</span><span class="p">,</span> <span class="n">dt</span><span class="p">);</span>
        
        <span class="c1">// Recalculate thickness and permittivity</span>
        <span class="k">self</span><span class="py">.membrane_thickness</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_effective_thickness</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="membrane-resistance-and-permeability">Membrane Resistance and Permeability</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre></td><td class="rouge-code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">MembranePermeability</span> <span class="p">{</span>
    <span class="c1">// Ion-specific permeabilities (m/s)</span>
    <span class="n">sodium_permeability</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="n">potassium_permeability</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="n">chloride_permeability</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="n">calcium_permeability</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    
    <span class="c1">// Composition dependencies</span>
    <span class="n">lipid_composition</span><span class="p">:</span> <span class="n">LipidComposition</span><span class="p">,</span>
    <span class="n">cholesterol_effect</span><span class="p">:</span> <span class="n">CholesterolEffect</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    
    <span class="c1">// ATP-dependent modifications</span>
    <span class="n">atp_dependent_flippases</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">AtpFlippase</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">asymmetric_composition</span><span class="p">:</span> <span class="n">AsymmetricComposition</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">MembranePermeability</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_ion_resistance</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">ion_type</span><span class="p">:</span> <span class="n">IonType</span><span class="p">,</span> <span class="n">membrane_area</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">permeability</span> <span class="o">=</span> <span class="k">match</span> <span class="n">ion_type</span> <span class="p">{</span>
            <span class="nn">IonType</span><span class="p">::</span><span class="n">Sodium</span> <span class="k">=&gt;</span> <span class="k">self</span><span class="py">.sodium_permeability</span><span class="p">,</span>
            <span class="nn">IonType</span><span class="p">::</span><span class="n">Potassium</span> <span class="k">=&gt;</span> <span class="k">self</span><span class="py">.potassium_permeability</span><span class="p">,</span>
            <span class="nn">IonType</span><span class="p">::</span><span class="n">Chloride</span> <span class="k">=&gt;</span> <span class="k">self</span><span class="py">.chloride_permeability</span><span class="p">,</span>
            <span class="nn">IonType</span><span class="p">::</span><span class="n">Calcium</span> <span class="k">=&gt;</span> <span class="k">self</span><span class="py">.calcium_permeability</span><span class="p">,</span>
        <span class="p">};</span>
        
        <span class="c1">// Apply composition corrections</span>
        <span class="k">let</span> <span class="n">composition_factor</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_composition_factor</span><span class="p">(</span><span class="n">ion_type</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">temperature_factor</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_temperature_factor</span><span class="p">();</span>
        
        <span class="k">let</span> <span class="n">effective_permeability</span> <span class="o">=</span> <span class="n">permeability</span> <span class="o">*</span> <span class="n">composition_factor</span> <span class="o">*</span> <span class="n">temperature_factor</span><span class="p">;</span>
        
        <span class="c1">// Convert permeability to resistance: R = 1/(P × A × F²/RT × z²)</span>
        <span class="k">let</span> <span class="n">faraday_constant</span> <span class="o">=</span> <span class="mf">96485.0</span><span class="p">;</span> <span class="c1">// C/mol</span>
        <span class="k">let</span> <span class="n">gas_constant</span> <span class="o">=</span> <span class="mf">8.314</span><span class="p">;</span> <span class="c1">// J/(mol⋅K)</span>
        <span class="k">let</span> <span class="n">ion_charge</span> <span class="o">=</span> <span class="n">ion_type</span><span class="nf">.charge</span><span class="p">();</span>
        
        <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">effective_permeability</span> <span class="o">*</span> <span class="n">membrane_area</span> <span class="o">*</span> 
               <span class="n">faraday_constant</span><span class="nf">.powi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gas_constant</span> <span class="o">*</span> <span class="k">self</span><span class="py">.temperature</span><span class="p">)</span> <span class="o">*</span> 
               <span class="n">ion_charge</span><span class="nf">.powi</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_composition_factor</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">ion_type</span><span class="p">:</span> <span class="n">IonType</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Different lipids have different effects on ion permeability</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
        
        <span class="c1">// Cholesterol generally decreases permeability</span>
        <span class="n">factor</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="k">self</span><span class="py">.cholesterol_effect.permeability_reduction</span> <span class="o">*</span> 
                  <span class="k">self</span><span class="py">.lipid_composition</span><span class="nf">.cholesterol_fraction</span><span class="p">();</span>
        
        <span class="c1">// Charged lipids affect charged ion permeability</span>
        <span class="k">if</span> <span class="n">ion_type</span><span class="nf">.is_cation</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">negative_lipid_fraction</span> <span class="o">=</span> <span class="k">self</span><span class="py">.lipid_composition</span><span class="nf">.get_fraction</span><span class="p">(</span><span class="nn">LipidType</span><span class="p">::</span><span class="n">PhosphatidylSerine</span><span class="p">);</span>
            <span class="n">factor</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">negative_lipid_fraction</span><span class="p">;</span> <span class="c1">// PS increases cation permeability</span>
        <span class="p">}</span>
        
        <span class="n">factor</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">update_for_atp_flippase_activity</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">atp_consumed</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ATP-dependent flippases change membrane asymmetry</span>
        <span class="k">for</span> <span class="n">flippase</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="py">.atp_dependent_flippases</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">flippase_activity</span> <span class="o">=</span> <span class="n">flippase</span><span class="nf">.calculate_activity</span><span class="p">(</span><span class="n">atp_consumed</span><span class="p">);</span>
            <span class="k">self</span><span class="py">.asymmetric_composition</span><span class="nf">.update_from_flippase_activity</span><span class="p">(</span><span class="n">flippase_activity</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="c1">// Asymmetry affects permeability</span>
        <span class="k">self</span><span class="nf">.update_permeabilities_from_asymmetry</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="protein-membrane-interactions">Protein-Membrane Interactions</h2>

<h3 id="transmembrane-protein-electrical-models">Transmembrane Protein Electrical Models</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
</pre></td><td class="rouge-code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">TransmembraneProteinElectrics</span> <span class="p">{</span>
    <span class="n">protein_id</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">protein_type</span><span class="p">:</span> <span class="n">ProteinType</span><span class="p">,</span>
    
    <span class="c1">// Structural properties</span>
    <span class="n">transmembrane_domains</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">hydrophobic_mismatch</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>    <span class="c1">// nm - difference between protein and membrane thickness</span>
    <span class="n">protein_radius</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>          <span class="c1">// nm - effective radius</span>
    
    <span class="c1">// Electrical properties</span>
    <span class="n">intrinsic_conductance</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>   <span class="c1">// S - protein conductance</span>
    <span class="n">voltage_dependence</span><span class="p">:</span> <span class="n">VoltageGating</span><span class="p">,</span>
    <span class="n">ion_selectivity</span><span class="p">:</span> <span class="n">IonSelectivity</span><span class="p">,</span>
    
    <span class="c1">// ATP-dependent properties</span>
    <span class="n">atp_binding_sites</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">AtpBindingSite</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">conformational_states</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">AtpConcentration</span><span class="p">,</span> <span class="n">ProteinConformation</span><span class="o">&gt;</span><span class="p">,</span>
    
    <span class="c1">// Membrane perturbation</span>
    <span class="n">lipid_annulus</span><span class="p">:</span> <span class="n">LipidAnnulus</span><span class="p">,</span>  <span class="c1">// Perturbed lipids around protein</span>
    <span class="n">membrane_curvature_induction</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">TransmembraneProteinElectrics</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_equivalent_circuit</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">membrane_voltage</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">atp_concentration</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ProteinEquivalentCircuit</span> <span class="p">{</span>
        <span class="k">match</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.protein_type</span> <span class="p">{</span>
            <span class="nn">ProteinType</span><span class="p">::</span><span class="n">IonChannel</span> <span class="p">{</span> <span class="n">gating_mechanism</span><span class="p">,</span> <span class="o">..</span> <span class="p">}</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="k">self</span><span class="nf">.calculate_ion_channel_circuit</span><span class="p">(</span><span class="n">membrane_voltage</span><span class="p">,</span> <span class="n">atp_concentration</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nn">ProteinType</span><span class="p">::</span><span class="n">AtpPump</span> <span class="p">{</span> <span class="o">..</span> <span class="p">}</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="k">self</span><span class="nf">.calculate_atp_pump_circuit</span><span class="p">(</span><span class="n">membrane_voltage</span><span class="p">,</span> <span class="n">atp_concentration</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nn">ProteinType</span><span class="p">::</span><span class="n">AtpSynthase</span> <span class="p">{</span> <span class="o">..</span> <span class="p">}</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="k">self</span><span class="nf">.calculate_atp_synthase_circuit</span><span class="p">(</span><span class="n">membrane_voltage</span><span class="p">,</span> <span class="n">atp_concentration</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">_</span> <span class="k">=&gt;</span> <span class="nn">ProteinEquivalentCircuit</span><span class="p">::</span><span class="nf">default</span><span class="p">(),</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_ion_channel_circuit</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">atp_conc</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ProteinEquivalentCircuit</span> <span class="p">{</span>
        <span class="c1">// Calculate open probability from voltage and ATP dependence</span>
        <span class="k">let</span> <span class="n">open_probability</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_open_probability</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="n">atp_conc</span><span class="p">);</span>
        
        <span class="c1">// Effective conductance</span>
        <span class="k">let</span> <span class="n">effective_conductance</span> <span class="o">=</span> <span class="k">self</span><span class="py">.intrinsic_conductance</span> <span class="o">*</span> <span class="n">open_probability</span><span class="p">;</span>
        
        <span class="c1">// Channel as voltage-dependent resistor</span>
        <span class="nn">ProteinEquivalentCircuit</span><span class="p">::</span><span class="n">VoltageGatedResistor</span> <span class="p">{</span>
            <span class="n">max_conductance</span><span class="p">:</span> <span class="k">self</span><span class="py">.intrinsic_conductance</span><span class="p">,</span>
            <span class="n">current_conductance</span><span class="p">:</span> <span class="n">effective_conductance</span><span class="p">,</span>
            <span class="n">reversal_potential</span><span class="p">:</span> <span class="k">self</span><span class="nf">.calculate_reversal_potential</span><span class="p">(),</span>
            <span class="n">gating_dynamics</span><span class="p">:</span> <span class="k">self</span><span class="nf">.calculate_gating_dynamics</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="n">atp_conc</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_atp_pump_circuit</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">atp_conc</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ProteinEquivalentCircuit</span> <span class="p">{</span>
        <span class="c1">// ATP pump as current source with internal resistance</span>
        <span class="k">let</span> <span class="n">pump_current</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_pump_current</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="n">atp_conc</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">internal_resistance</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_pump_resistance</span><span class="p">(</span><span class="n">atp_conc</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">atp_consumption_rate</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_atp_consumption_rate</span><span class="p">(</span><span class="n">pump_current</span><span class="p">);</span>
        
        <span class="nn">ProteinEquivalentCircuit</span><span class="p">::</span><span class="n">CurrentSource</span> <span class="p">{</span>
            <span class="n">current</span><span class="p">:</span> <span class="n">pump_current</span><span class="p">,</span>
            <span class="n">internal_resistance</span><span class="p">,</span>
            <span class="n">voltage_dependence</span><span class="p">:</span> <span class="k">self</span><span class="nf">.calculate_pump_voltage_dependence</span><span class="p">(),</span>
            <span class="n">atp_consumption_rate</span><span class="p">,</span>
            <span class="n">power_consumption</span><span class="p">:</span> <span class="n">pump_current</span> <span class="o">*</span> <span class="n">voltage</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_atp_synthase_circuit</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">atp_conc</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ProteinEquivalentCircuit</span> <span class="p">{</span>
        <span class="c1">// ATP synthase as reversible current source/sink</span>
        <span class="k">let</span> <span class="n">synthase_current</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_synthase_current</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="n">atp_conc</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">internal_resistance</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_synthase_resistance</span><span class="p">(</span><span class="n">atp_conc</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">atp_production_rate</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_atp_production_rate</span><span class="p">(</span><span class="n">synthase_current</span><span class="p">);</span>
        
        <span class="nn">ProteinEquivalentCircuit</span><span class="p">::</span><span class="n">ReversibleCurrentSource</span> <span class="p">{</span>
            <span class="n">current</span><span class="p">:</span> <span class="n">synthase_current</span><span class="p">,</span>
            <span class="n">internal_resistance</span><span class="p">,</span>
            <span class="n">forward_bias_voltage</span><span class="p">:</span> <span class="k">self</span><span class="nf">.calculate_forward_bias_voltage</span><span class="p">(</span><span class="n">atp_conc</span><span class="p">),</span>
            <span class="n">reverse_bias_voltage</span><span class="p">:</span> <span class="k">self</span><span class="nf">.calculate_reverse_bias_voltage</span><span class="p">(</span><span class="n">atp_conc</span><span class="p">),</span>
            <span class="n">atp_production_rate</span><span class="p">,</span>
            <span class="n">power_generation</span><span class="p">:</span> <span class="o">-</span><span class="n">synthase_current</span> <span class="o">*</span> <span class="n">voltage</span><span class="p">,</span> <span class="c1">// Negative for power generation</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_membrane_perturbation</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">MembranePertu</span> <span class="n">rbation</span> <span class="p">{</span>
        <span class="c1">// How protein affects surrounding membrane</span>
        <span class="k">let</span> <span class="n">thickness_perturbation</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_thickness_perturbation</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">curvature_induction</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_curvature_induction</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">lipid_ordering</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_lipid_ordering_effect</span><span class="p">();</span>
        
        <span class="n">MembraneP</span> <span class="n">erturbation</span> <span class="p">{</span>
            <span class="n">affected_radius</span><span class="p">:</span> <span class="k">self</span><span class="py">.protein_radius</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">,</span> <span class="c1">// ~2 nm perturbation radius</span>
            <span class="n">thickness_change</span><span class="p">:</span> <span class="n">thickness_perturbation</span><span class="p">,</span>
            <span class="n">curvature_change</span><span class="p">:</span> <span class="n">curvature_induction</span><span class="p">,</span>
            <span class="n">lipid_ordering_change</span><span class="p">:</span> <span class="n">lipid_ordering</span><span class="p">,</span>
            <span class="n">capacitance_change</span><span class="p">:</span> <span class="k">self</span><span class="nf">.calculate_capacitance_perturbation</span><span class="p">(),</span>
            <span class="n">resistance_change</span><span class="p">:</span> <span class="k">self</span><span class="nf">.calculate_resistance_perturbation</span><span class="p">(),</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="atp-dependent-protein-conformational-changes">ATP-Dependent Protein Conformational Changes</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
</pre></td><td class="rouge-code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">AtpDependentConformations</span> <span class="p">{</span>
    <span class="n">protein_id</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    
    <span class="c1">// ATP binding sites and their effects</span>
    <span class="n">atp_binding_sites</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">AtpBindingSite</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">cooperative_binding</span><span class="p">:</span> <span class="n">CooperativeBinding</span><span class="p">,</span>
    
    <span class="c1">// Conformational states</span>
    <span class="n">conformational_states</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">ConformationId</span><span class="p">,</span> <span class="n">ProteinConformation</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">transition_rates</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="p">(</span><span class="n">ConformationId</span><span class="p">,</span> <span class="n">ConformationId</span><span class="p">),</span> <span class="nb">f64</span><span class="o">&gt;</span><span class="p">,</span>
    
    <span class="c1">// Electrical consequences</span>
    <span class="n">conformation_conductances</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">ConformationId</span><span class="p">,</span> <span class="nb">f64</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">conformation_capacitances</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">ConformationId</span><span class="p">,</span> <span class="nb">f64</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="nd">#[derive(Debug,</span> <span class="nd">Clone)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">AtpBindingSite</span> <span class="p">{</span>
    <span class="n">site_id</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">binding_affinity</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>        <span class="c1">// M⁻¹ - association constant</span>
    <span class="n">cooperativity_factor</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>    <span class="c1">// Hill coefficient</span>
    <span class="n">conformational_effect</span><span class="p">:</span> <span class="n">ConformationalEffect</span><span class="p">,</span>
<span class="p">}</span>

<span class="nd">#[derive(Debug,</span> <span class="nd">Clone)]</span>
<span class="k">pub</span> <span class="k">enum</span> <span class="n">ConformationalEffect</span> <span class="p">{</span>
    <span class="nf">ConductanceChange</span><span class="p">(</span><span class="nb">f64</span><span class="p">),</span>       <span class="c1">// Factor by which conductance changes</span>
    <span class="nf">GatingEffect</span><span class="p">(</span><span class="n">GatingEffect</span><span class="p">),</span>   <span class="c1">// Changes in voltage/time dependence</span>
    <span class="nf">SelectivityChange</span><span class="p">(</span><span class="n">SelectivityChange</span><span class="p">),</span> <span class="c1">// Changes in ion selectivity</span>
    <span class="nf">ATPConsumptionChange</span><span class="p">(</span><span class="nb">f64</span><span class="p">),</span>    <span class="c1">// Changes in ATP consumption rate</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">AtpDependentConformations</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_current_conformation</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">atp_concentration</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ProteinConformation</span> <span class="p">{</span>
        <span class="c1">// Calculate occupancy of each ATP binding site</span>
        <span class="k">let</span> <span class="n">site_occupancies</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_site_occupancies</span><span class="p">(</span><span class="n">atp_concentration</span><span class="p">);</span>
        
        <span class="c1">// Determine most probable conformation</span>
        <span class="k">let</span> <span class="n">conformation_probabilities</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_conformation_probabilities</span><span class="p">(</span><span class="o">&amp;</span><span class="n">site_occupancies</span><span class="p">);</span>
        
        <span class="c1">// Weighted average of conformational properties</span>
        <span class="k">self</span><span class="nf">.average_conformational_properties</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conformation_probabilities</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_site_occupancies</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">atp_conc</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">occupancies</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        
        <span class="k">for</span> <span class="n">site</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.atp_binding_sites</span> <span class="p">{</span>
            <span class="c1">// Hill equation for cooperative binding</span>
            <span class="k">let</span> <span class="n">occupancy</span> <span class="o">=</span> <span class="p">(</span><span class="n">site</span><span class="py">.binding_affinity</span> <span class="o">*</span> <span class="n">atp_conc</span><span class="p">)</span><span class="nf">.powf</span><span class="p">(</span><span class="n">site</span><span class="py">.cooperativity_factor</span><span class="p">)</span> <span class="o">/</span>
                          <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">site</span><span class="py">.binding_affinity</span> <span class="o">*</span> <span class="n">atp_conc</span><span class="p">)</span><span class="nf">.powf</span><span class="p">(</span><span class="n">site</span><span class="py">.cooperativity_factor</span><span class="p">));</span>
            <span class="n">occupancies</span><span class="nf">.push</span><span class="p">(</span><span class="n">occupancy</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="n">occupancies</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_conformation_probabilities</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">site_occupancies</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">f64</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">ConformationId</span><span class="p">,</span> <span class="nb">f64</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        
        <span class="c1">// Each combination of site occupancies corresponds to a conformation</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">conformation_id</span><span class="p">,</span> <span class="n">conformation</span><span class="p">)</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.conformational_states</span> <span class="p">{</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">probability</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
            
            <span class="k">for</span> <span class="p">(</span><span class="n">site_idx</span><span class="p">,</span> <span class="n">required_occupancy</span><span class="p">)</span> <span class="k">in</span> <span class="n">conformation</span><span class="py">.required_site_states</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.enumerate</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="o">*</span><span class="n">required_occupancy</span> <span class="p">{</span>
                    <span class="n">probability</span> <span class="o">*=</span> <span class="n">site_occupancies</span><span class="p">[</span><span class="n">site_idx</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">probability</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">site_occupancies</span><span class="p">[</span><span class="n">site_idx</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
            
            <span class="n">probabilities</span><span class="nf">.insert</span><span class="p">(</span><span class="o">*</span><span class="n">conformation_id</span><span class="p">,</span> <span class="n">probability</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="c1">// Normalize probabilities</span>
        <span class="k">let</span> <span class="n">total_probability</span><span class="p">:</span> <span class="nb">f64</span> <span class="o">=</span> <span class="n">probabilities</span><span class="nf">.values</span><span class="p">()</span><span class="nf">.sum</span><span class="p">();</span>
        <span class="k">for</span> <span class="n">probability</span> <span class="k">in</span> <span class="n">probabilities</span><span class="nf">.values_mut</span><span class="p">()</span> <span class="p">{</span>
            <span class="o">*</span><span class="n">probability</span> <span class="o">/=</span> <span class="n">total_probability</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">probabilities</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_atp_dependent_conductance</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">atp_concentration</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">conformation_probabilities</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_conformation_probabilities</span><span class="p">(</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="nf">.calculate_site_occupancies</span><span class="p">(</span><span class="n">atp_concentration</span><span class="p">)</span>
        <span class="p">);</span>
        
        <span class="k">let</span> <span class="k">mut</span> <span class="n">weighted_conductance</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">conformation_id</span><span class="p">,</span> <span class="n">probability</span><span class="p">)</span> <span class="k">in</span> <span class="n">conformation_probabilities</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">conductance</span> <span class="o">=</span> <span class="k">self</span><span class="py">.conformation_conductances</span><span class="p">[</span><span class="o">&amp;</span><span class="n">conformation_id</span><span class="p">];</span>
            <span class="n">weighted_conductance</span> <span class="o">+=</span> <span class="n">conductance</span> <span class="o">*</span> <span class="n">probability</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">weighted_conductance</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="membrane-curvature-dynamics">Membrane Curvature Dynamics</h2>

<h3 id="curvature-electrical-property-coupling">Curvature-Electrical Property Coupling</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
</pre></td><td class="rouge-code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">MembraneCurvatureDynamics</span> <span class="p">{</span>
    <span class="c1">// Curvature properties</span>
    <span class="n">spontaneous_curvature</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>   <span class="c1">// m⁻¹ - intrinsic curvature preference</span>
    <span class="n">bending_modulus</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>         <span class="c1">// J - resistance to bending</span>
    <span class="n">gaussian_modulus</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>        <span class="c1">// J - resistance to topology changes</span>
    
    <span class="c1">// Current membrane shape</span>
    <span class="n">mean_curvature</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>          <span class="c1">// m⁻¹ - average curvature</span>
    <span class="n">gaussian_curvature</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>      <span class="c1">// m⁻² - topology measure</span>
    
    <span class="c1">// Protein-curvature coupling</span>
    <span class="n">curvature_sensing_proteins</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">CurvatureSensingProtein</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">curvature_inducing_proteins</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">CurvatureInducingProtein</span><span class="o">&gt;</span><span class="p">,</span>
    
    <span class="c1">// ATP-dependent curvature generation</span>
    <span class="n">atp_dependent_curvature_generators</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">AtpCurvatureGenerator</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">MembraneCurvatureDynamics</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_curvature_electrical_effects</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">CurvatureElectricalEffects</span> <span class="p">{</span>
        <span class="c1">// Curvature affects membrane electrical properties</span>
        <span class="k">let</span> <span class="n">capacitance_effect</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_curvature_capacitance_effect</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">resistance_effect</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_curvature_resistance_effect</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">protein_activity_effect</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_curvature_protein_effects</span><span class="p">();</span>
        
        <span class="n">CurvatureElectricalEffects</span> <span class="p">{</span>
            <span class="n">capacitance_modification</span><span class="p">:</span> <span class="n">capacitance_effect</span><span class="p">,</span>
            <span class="n">resistance_modification</span><span class="p">:</span> <span class="n">resistance_effect</span><span class="p">,</span>
            <span class="n">protein_activity_modifications</span><span class="p">:</span> <span class="n">protein_activity_effect</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_curvature_capacitance_effect</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Curvature changes effective membrane area and thickness</span>
        <span class="k">let</span> <span class="n">area_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="k">self</span><span class="py">.mean_curvature</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c1">// Curved membranes have larger effective area</span>
        <span class="k">let</span> <span class="n">thickness_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="k">self</span><span class="py">.mean_curvature</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">;</span> <span class="c1">// Curvature slightly reduces effective thickness</span>
        
        <span class="n">area_factor</span> <span class="o">/</span> <span class="n">thickness_factor</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_curvature_resistance_effect</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Curvature affects lipid packing and permeability</span>
        <span class="k">let</span> <span class="n">packing_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="k">self</span><span class="py">.mean_curvature</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c1">// Curvature loosens packing</span>
        <span class="k">let</span> <span class="n">permeability_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">packing_factor</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">;</span> <span class="c1">// Looser packing increases permeability</span>
        
        <span class="mf">1.0</span> <span class="o">/</span> <span class="n">permeability_factor</span> <span class="c1">// Resistance is inverse of permeability</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_curvature_protein_effects</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nb">f64</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">effects</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        
        <span class="c1">// Curvature-sensing proteins change activity with curvature</span>
        <span class="k">for</span> <span class="n">protein</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.curvature_sensing_proteins</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">activity_change</span> <span class="o">=</span> <span class="n">protein</span><span class="nf">.calculate_curvature_response</span><span class="p">(</span><span class="k">self</span><span class="py">.mean_curvature</span><span class="p">);</span>
            <span class="n">effects</span><span class="nf">.insert</span><span class="p">(</span><span class="n">protein</span><span class="py">.protein_id</span><span class="nf">.clone</span><span class="p">(),</span> <span class="n">activity_change</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="n">effects</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">update_curvature_for_atp_consumption</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">atp_consumed</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ATP-dependent processes can generate membrane curvature</span>
        <span class="k">for</span> <span class="n">generator</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="py">.atp_dependent_curvature_generators</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">curvature_change</span> <span class="o">=</span> <span class="n">generator</span><span class="nf">.calculate_curvature_generation</span><span class="p">(</span><span class="n">atp_consumed</span><span class="p">,</span> <span class="n">dt</span><span class="p">);</span>
            <span class="k">self</span><span class="nf">.apply_curvature_change</span><span class="p">(</span><span class="n">curvature_change</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="c1">// Update protein activities based on new curvature</span>
        <span class="k">self</span><span class="nf">.update_protein_curvature_responses</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_curvature_energy</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Helfrich bending energy</span>
        <span class="k">let</span> <span class="n">bending_energy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="k">self</span><span class="py">.bending_modulus</span> <span class="o">*</span> 
                           <span class="p">(</span><span class="k">self</span><span class="py">.mean_curvature</span> <span class="o">-</span> <span class="k">self</span><span class="py">.spontaneous_curvature</span><span class="p">)</span><span class="nf">.powi</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">gaussian_energy</span> <span class="o">=</span> <span class="k">self</span><span class="py">.gaussian_modulus</span> <span class="o">*</span> <span class="k">self</span><span class="py">.gaussian_curvature</span><span class="p">;</span>
        
        <span class="n">bending_energy</span> <span class="o">+</span> <span class="n">gaussian_energy</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[derive(Debug,</span> <span class="nd">Clone)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">CurvatureSensingProtein</span> <span class="p">{</span>
    <span class="n">protein_id</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">curvature_sensitivity</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>   <span class="c1">// Response magnitude per unit curvature</span>
    <span class="n">optimal_curvature</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>       <span class="c1">// m⁻¹ - preferred curvature</span>
    <span class="n">activity_modulation</span><span class="p">:</span> <span class="n">ActivityModulation</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">CurvatureSensingProtein</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_curvature_response</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">membrane_curvature</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Activity changes based on deviation from optimal curvature</span>
        <span class="k">let</span> <span class="n">curvature_deviation</span> <span class="o">=</span> <span class="p">(</span><span class="n">membrane_curvature</span> <span class="o">-</span> <span class="k">self</span><span class="py">.optimal_curvature</span><span class="p">)</span><span class="nf">.abs</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">activity_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="k">self</span><span class="py">.curvature_sensitivity</span> <span class="o">*</span> <span class="n">curvature_deviation</span><span class="p">;</span>
        
        <span class="k">match</span> <span class="k">self</span><span class="py">.activity_modulation</span> <span class="p">{</span>
            <span class="nn">ActivityModulation</span><span class="p">::</span><span class="n">Increase</span> <span class="k">=&gt;</span> <span class="n">activity_factor</span><span class="p">,</span>
            <span class="nn">ActivityModulation</span><span class="p">::</span><span class="n">Decrease</span> <span class="k">=&gt;</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">activity_factor</span><span class="p">,</span>
            <span class="nn">ActivityModulation</span><span class="p">::</span><span class="n">Optimal</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="c1">// Bell-shaped response - maximum activity at optimal curvature</span>
                <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">curvature_deviation</span><span class="nf">.powi</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="nf">.exp</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="electrochemical-gradients">Electrochemical Gradients</h2>

<h3 id="ion-distribution-and-membrane-potential">Ion Distribution and Membrane Potential</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
</pre></td><td class="rouge-code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">ElectrochemicalGradients</span> <span class="p">{</span>
    <span class="c1">// Ion concentrations (mM)</span>
    <span class="n">intracellular_concentrations</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">IonType</span><span class="p">,</span> <span class="nb">f64</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">extracellular_concentrations</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">IonType</span><span class="p">,</span> <span class="nb">f64</span><span class="o">&gt;</span><span class="p">,</span>
    
    <span class="c1">// Membrane properties</span>
    <span class="n">membrane_potential</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>      <span class="c1">// mV</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>             <span class="c1">// K</span>
    
    <span class="c1">// ATP-dependent ion pumps</span>
    <span class="n">atp_pumps</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">AtpIonPump</span><span class="o">&gt;</span><span class="p">,</span>
    
    <span class="c1">// Passive leak channels</span>
    <span class="n">leak_channels</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">IonType</span><span class="p">,</span> <span class="nb">f64</span><span class="o">&gt;</span><span class="p">,</span> <span class="c1">// Permeabilities in m/s</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">ElectrochemicalGradients</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_nernst_potential</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">ion_type</span><span class="p">:</span> <span class="n">IonType</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Nernst equation: E = (RT/zF) * ln([ion]_out / [ion]_in)</span>
        <span class="k">let</span> <span class="n">gas_constant</span> <span class="o">=</span> <span class="mf">8.314</span><span class="p">;</span> <span class="c1">// J/(mol⋅K)</span>
        <span class="k">let</span> <span class="n">faraday_constant</span> <span class="o">=</span> <span class="mf">96485.0</span><span class="p">;</span> <span class="c1">// C/mol</span>
        <span class="k">let</span> <span class="n">ion_charge</span> <span class="o">=</span> <span class="n">ion_type</span><span class="nf">.charge</span><span class="p">();</span>
        
        <span class="k">let</span> <span class="n">conc_out</span> <span class="o">=</span> <span class="k">self</span><span class="py">.extracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="n">ion_type</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">conc_in</span> <span class="o">=</span> <span class="k">self</span><span class="py">.intracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="n">ion_type</span><span class="p">];</span>
        
        <span class="p">(</span><span class="n">gas_constant</span> <span class="o">*</span> <span class="k">self</span><span class="py">.temperature</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ion_charge</span> <span class="k">as</span> <span class="nb">f64</span> <span class="o">*</span> <span class="n">faraday_constant</span><span class="p">)</span> <span class="o">*</span> 
        <span class="p">(</span><span class="n">conc_out</span> <span class="o">/</span> <span class="n">conc_in</span><span class="p">)</span><span class="nf">.ln</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="c1">// Convert to mV</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_goldman_potential</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Goldman-Hodgkin-Katz equation for membrane potential</span>
        <span class="k">let</span> <span class="n">pk</span> <span class="o">=</span> <span class="k">self</span><span class="py">.leak_channels</span><span class="p">[</span><span class="o">&amp;</span><span class="nn">IonType</span><span class="p">::</span><span class="n">Potassium</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">pna</span> <span class="o">=</span> <span class="k">self</span><span class="py">.leak_channels</span><span class="p">[</span><span class="o">&amp;</span><span class="nn">IonType</span><span class="p">::</span><span class="n">Sodium</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">pcl</span> <span class="o">=</span> <span class="k">self</span><span class="py">.leak_channels</span><span class="p">[</span><span class="o">&amp;</span><span class="nn">IonType</span><span class="p">::</span><span class="n">Chloride</span><span class="p">];</span>
        
        <span class="k">let</span> <span class="n">k_out</span> <span class="o">=</span> <span class="k">self</span><span class="py">.extracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="nn">IonType</span><span class="p">::</span><span class="n">Potassium</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">k_in</span> <span class="o">=</span> <span class="k">self</span><span class="py">.intracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="nn">IonType</span><span class="p">::</span><span class="n">Potassium</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">na_out</span> <span class="o">=</span> <span class="k">self</span><span class="py">.extracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="nn">IonType</span><span class="p">::</span><span class="n">Sodium</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">na_in</span> <span class="o">=</span> <span class="k">self</span><span class="py">.intracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="nn">IonType</span><span class="p">::</span><span class="n">Sodium</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">cl_out</span> <span class="o">=</span> <span class="k">self</span><span class="py">.extracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="nn">IonType</span><span class="p">::</span><span class="n">Chloride</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">cl_in</span> <span class="o">=</span> <span class="k">self</span><span class="py">.intracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="nn">IonType</span><span class="p">::</span><span class="n">Chloride</span><span class="p">];</span>
        
        <span class="k">let</span> <span class="n">numerator</span> <span class="o">=</span> <span class="n">pk</span> <span class="o">*</span> <span class="n">k_out</span> <span class="o">+</span> <span class="n">pna</span> <span class="o">*</span> <span class="n">na_out</span> <span class="o">+</span> <span class="n">pcl</span> <span class="o">*</span> <span class="n">cl_in</span><span class="p">;</span> <span class="c1">// Note: Cl inside for anions</span>
        <span class="k">let</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">pk</span> <span class="o">*</span> <span class="n">k_in</span> <span class="o">+</span> <span class="n">pna</span> <span class="o">*</span> <span class="n">na_in</span> <span class="o">+</span> <span class="n">pcl</span> <span class="o">*</span> <span class="n">cl_out</span><span class="p">;</span>
        
        <span class="k">let</span> <span class="n">rt_f</span> <span class="o">=</span> <span class="mf">8.314</span> <span class="o">*</span> <span class="k">self</span><span class="py">.temperature</span> <span class="o">/</span> <span class="mf">96485.0</span><span class="p">;</span>
        <span class="n">rt_f</span> <span class="o">*</span> <span class="p">(</span><span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">)</span><span class="nf">.ln</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="c1">// Convert to mV</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">update_for_atp_pump_activity</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">atp_consumed</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Update ion concentrations based on ATP pump activity</span>
        <span class="k">for</span> <span class="n">pump</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="py">.atp_pumps</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">pump_activity</span> <span class="o">=</span> <span class="n">pump</span><span class="nf">.calculate_activity</span><span class="p">(</span><span class="n">atp_consumed</span><span class="p">,</span> <span class="k">self</span><span class="py">.membrane_potential</span><span class="p">);</span>
            <span class="k">let</span> <span class="n">ion_flux</span> <span class="o">=</span> <span class="n">pump</span><span class="nf">.calculate_ion_flux</span><span class="p">(</span><span class="n">pump_activity</span><span class="p">,</span> <span class="n">dt</span><span class="p">);</span>
            
            <span class="c1">// Update concentrations</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ion_type</span><span class="p">,</span> <span class="n">flux</span><span class="p">)</span> <span class="k">in</span> <span class="n">ion_flux</span> <span class="p">{</span>
                <span class="k">self</span><span class="py">.intracellular_concentrations</span><span class="nf">.entry</span><span class="p">(</span><span class="n">ion_type</span><span class="p">)</span>
                    <span class="nf">.and_modify</span><span class="p">(|</span><span class="n">conc</span><span class="p">|</span> <span class="o">*</span><span class="n">conc</span> <span class="o">+=</span> <span class="n">flux</span><span class="py">.intracellular_change</span><span class="p">);</span>
                <span class="k">self</span><span class="py">.extracellular_concentrations</span><span class="nf">.entry</span><span class="p">(</span><span class="n">ion_type</span><span class="p">)</span>
                    <span class="nf">.and_modify</span><span class="p">(|</span><span class="n">conc</span><span class="p">|</span> <span class="o">*</span><span class="n">conc</span> <span class="o">+=</span> <span class="n">flux</span><span class="py">.extracellular_change</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1">// Recalculate membrane potential</span>
        <span class="k">self</span><span class="py">.membrane_potential</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_goldman_potential</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_driving_force</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">ion_type</span><span class="p">:</span> <span class="n">IonType</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Electrochemical driving force: V_m - E_ion</span>
        <span class="k">let</span> <span class="n">nernst_potential</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_nernst_potential</span><span class="p">(</span><span class="n">ion_type</span><span class="p">);</span>
        <span class="k">self</span><span class="py">.membrane_potential</span> <span class="o">-</span> <span class="n">nernst_potential</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_ion_current</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">ion_type</span><span class="p">:</span> <span class="n">IonType</span><span class="p">,</span> <span class="n">conductance</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Ohmic current: I = g * (V_m - E_ion)</span>
        <span class="k">let</span> <span class="n">driving_force</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_driving_force</span><span class="p">(</span><span class="n">ion_type</span><span class="p">);</span>
        <span class="n">conductance</span> <span class="o">*</span> <span class="n">driving_force</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="c1">// Convert mV to V</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[derive(Debug,</span> <span class="nd">Clone)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">AtpIonPump</span> <span class="p">{</span>
    <span class="n">pump_type</span><span class="p">:</span> <span class="n">PumpType</span><span class="p">,</span>
    <span class="n">max_turnover_rate</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>       <span class="c1">// s⁻¹</span>
    <span class="n">atp_stoichiometry</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>       <span class="c1">// ATP consumed per cycle</span>
    <span class="n">ion_stoichiometry</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">IonType</span><span class="p">,</span> <span class="nb">i8</span><span class="o">&gt;</span><span class="p">,</span> <span class="c1">// Ions moved per cycle (+ out, - in)</span>
    <span class="n">voltage_dependence</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>      <span class="c1">// Voltage dependence factor</span>
    <span class="n">atp_km</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>                  <span class="c1">// mM - Michaelis constant for ATP</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">AtpIonPump</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_activity</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">atp_concentration</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">membrane_voltage</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Michaelis-Menten kinetics for ATP dependence</span>
        <span class="k">let</span> <span class="n">atp_factor</span> <span class="o">=</span> <span class="n">atp_concentration</span> <span class="o">/</span> <span class="p">(</span><span class="k">self</span><span class="py">.atp_km</span> <span class="o">+</span> <span class="n">atp_concentration</span><span class="p">);</span>
        
        <span class="c1">// Voltage dependence (some pumps are electrogenic)</span>
        <span class="k">let</span> <span class="n">voltage_factor</span> <span class="o">=</span> <span class="k">if</span> <span class="k">self</span><span class="py">.voltage_dependence</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="p">{</span>
            <span class="p">(</span><span class="o">-</span><span class="k">self</span><span class="py">.voltage_dependence</span> <span class="o">*</span> <span class="n">membrane_voltage</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span><span class="nf">.exp</span><span class="p">()</span> <span class="c1">// Convert mV to V</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="mf">1.0</span>
        <span class="p">};</span>
        
        <span class="k">self</span><span class="py">.max_turnover_rate</span> <span class="o">*</span> <span class="n">atp_factor</span> <span class="o">*</span> <span class="n">voltage_factor</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_atp_consumption_rate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">activity</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="n">activity</span> <span class="o">*</span> <span class="k">self</span><span class="py">.atp_stoichiometry</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="circuit-parameter-integration">Circuit Parameter Integration</h2>

<h3 id="dynamic-circuit-parameter-calculation">Dynamic Circuit Parameter Calculation</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre></td><td class="rouge-code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">MolecularToCircuitMapper</span> <span class="p">{</span>
    <span class="c1">// Layer components</span>
    <span class="n">bilayer_physics</span><span class="p">:</span> <span class="n">LipidBilayerCapacitance</span><span class="p">,</span>
    <span class="n">protein_electrics</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">TransmembraneProteinElectrics</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">curvature_dynamics</span><span class="p">:</span> <span class="n">MembraneCurvatureDynamics</span><span class="p">,</span>
    <span class="n">gradients</span><span class="p">:</span> <span class="n">ElectrochemicalGradients</span><span class="p">,</span>
    
    <span class="c1">// Mapping parameters</span>
    <span class="n">membrane_area</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>           <span class="c1">// m² - total membrane area</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>             <span class="c1">// K</span>
    
    <span class="c1">// ATP coupling</span>
    <span class="n">current_atp_concentration</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="c1">// mM</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">MolecularToCircuitMapper</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_circuit_parameters</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">CircuitParameters</span> <span class="p">{</span>
        <span class="c1">// Membrane capacitance</span>
        <span class="k">let</span> <span class="n">specific_capacitance</span> <span class="o">=</span> <span class="k">self</span><span class="py">.bilayer_physics</span><span class="nf">.calculate_specific_capacitance</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">curvature_effects</span> <span class="o">=</span> <span class="k">self</span><span class="py">.curvature_dynamics</span><span class="nf">.calculate_curvature_electrical_effects</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">total_capacitance</span> <span class="o">=</span> <span class="n">specific_capacitance</span> <span class="o">*</span> <span class="k">self</span><span class="py">.membrane_area</span> <span class="o">*</span> 
                               <span class="n">curvature_effects</span><span class="py">.capacitance_modification</span><span class="p">;</span>
        
        <span class="c1">// Membrane resistance (parallel combination of all ion pathways)</span>
        <span class="k">let</span> <span class="n">total_conductance</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_total_membrane_conductance</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">total_resistance</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">total_conductance</span><span class="p">;</span>
        
        <span class="c1">// Protein circuit elements</span>
        <span class="k">let</span> <span class="n">protein_circuits</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_protein_circuit_elements</span><span class="p">();</span>
        
        <span class="c1">// Electrochemical potentials</span>
        <span class="k">let</span> <span class="n">equilibrium_potentials</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.calculate_equilibrium_potentials</span><span class="p">();</span>
        
        <span class="n">CircuitParameters</span> <span class="p">{</span>
            <span class="n">membrane_capacitance</span><span class="p">:</span> <span class="n">total_capacitance</span><span class="p">,</span>
            <span class="n">membrane_resistance</span><span class="p">:</span> <span class="n">total_resistance</span><span class="p">,</span>
            <span class="n">protein_elements</span><span class="p">:</span> <span class="n">protein_circuits</span><span class="p">,</span>
            <span class="n">equilibrium_potentials</span><span class="p">,</span>
            <span class="n">membrane_potential</span><span class="p">:</span> <span class="k">self</span><span class="py">.gradients.membrane_potential</span><span class="p">,</span>
            <span class="n">atp_dependencies</span><span class="p">:</span> <span class="k">self</span><span class="nf">.calculate_atp_dependencies</span><span class="p">(),</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">calculate_total_membrane_conductance</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">total_conductance</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        
        <span class="c1">// Passive leak conductances</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ion_type</span><span class="p">,</span> <span class="n">permeability</span><span class="p">)</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.gradients.leak_channels</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">ion_conductance</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.permeability_to_conductance</span><span class="p">(</span><span class="o">*</span><span class="n">permeability</span><span class="p">,</span> <span class="o">*</span><span class="n">ion_type</span><span class="p">);</span>
            <span class="n">total_conductance</span> <span class="o">+=</span> <span class="n">ion_conductance</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Protein conductances</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">protein_id</span><span class="p">,</span> <span class="n">protein</span><span class="p">)</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.protein_electrics</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">protein_conductance</span> <span class="o">=</span> <span class="n">protein</span><span class="nf">.calculate_atp_dependent_conductance</span><span class="p">(</span>
                <span class="k">self</span><span class="py">.current_atp_concentration</span>
            <span class="p">);</span>
            <span class="n">total_conductance</span> <span class="o">+=</span> <span class="n">protein_conductance</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Curvature effects</span>
        <span class="k">let</span> <span class="n">curvature_effects</span> <span class="o">=</span> <span class="k">self</span><span class="py">.curvature_dynamics</span><span class="nf">.calculate_curvature_electrical_effects</span><span class="p">();</span>
        <span class="n">total_conductance</span> <span class="o">*=</span> <span class="n">curvature_effects</span><span class="py">.resistance_modification</span><span class="p">;</span>
        
        <span class="n">total_conductance</span>
    <span class="p">}</span>
    
    <span class="k">fn</span> <span class="nf">permeability_to_conductance</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">permeability</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">ion_type</span><span class="p">:</span> <span class="n">IonType</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="c1">// Convert permeability (m/s) to conductance (S)</span>
        <span class="k">let</span> <span class="n">faraday_constant</span> <span class="o">=</span> <span class="mf">96485.0</span><span class="p">;</span> <span class="c1">// C/mol</span>
        <span class="k">let</span> <span class="n">gas_constant</span> <span class="o">=</span> <span class="mf">8.314</span><span class="p">;</span> <span class="c1">// J/(mol⋅K)</span>
        <span class="k">let</span> <span class="n">ion_charge</span> <span class="o">=</span> <span class="n">ion_type</span><span class="nf">.charge</span><span class="p">();</span>
        
        <span class="k">let</span> <span class="n">ion_concentration</span> <span class="o">=</span> <span class="p">(</span><span class="k">self</span><span class="py">.gradients.intracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="n">ion_type</span><span class="p">]</span> <span class="o">+</span> 
                               <span class="k">self</span><span class="py">.gradients.extracellular_concentrations</span><span class="p">[</span><span class="o">&amp;</span><span class="n">ion_type</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span> <span class="c1">// Average</span>
        
        <span class="n">permeability</span> <span class="o">*</span> <span class="k">self</span><span class="py">.membrane_area</span> <span class="o">*</span> <span class="n">ion_concentration</span> <span class="o">*</span> 
        <span class="n">faraday_constant</span><span class="nf">.powi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gas_constant</span> <span class="o">*</span> <span class="k">self</span><span class="py">.temperature</span><span class="p">)</span> <span class="o">*</span> 
        <span class="n">ion_charge</span><span class="nf">.powi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">update_for_atp_changes</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">atp_consumption</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">new_atp_concentration</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Update all molecular components for ATP changes</span>
        <span class="k">self</span><span class="py">.bilayer_physics</span><span class="nf">.update_for_atp_consumption</span><span class="p">(</span><span class="n">atp_consumption</span><span class="p">,</span> <span class="n">dt</span><span class="p">);</span>
        
        <span class="k">for</span> <span class="n">protein</span> <span class="k">in</span> <span class="k">self</span><span class="py">.protein_electrics</span><span class="nf">.values_mut</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">protein</span><span class="nf">.update_for_atp_changes</span><span class="p">(</span><span class="n">atp_consumption</span><span class="p">,</span> <span class="n">new_atp_concentration</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="k">self</span><span class="py">.curvature_dynamics</span><span class="nf">.update_curvature_for_atp_consumption</span><span class="p">(</span><span class="n">atp_consumption</span><span class="p">,</span> <span class="n">dt</span><span class="p">);</span>
        <span class="k">self</span><span class="py">.gradients</span><span class="nf">.update_for_atp_pump_activity</span><span class="p">(</span><span class="n">atp_consumption</span><span class="p">,</span> <span class="n">dt</span><span class="p">);</span>
        
        <span class="k">self</span><span class="py">.current_atp_concentration</span> <span class="o">=</span> <span class="n">new_atp_concentration</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="example-atp-synthase-circuit-modeling">Example: ATP Synthase Circuit Modeling</h2>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td><td class="rouge-code"><pre><span class="c1">// Example: Detailed ATP synthase circuit model</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">create_atp_synthase_circuit</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">TransmembraneProteinElectrics</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">atp_synthase</span> <span class="o">=</span> <span class="nn">TransmembraneProteinElectrics</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="s">"atp_synthase_f0f1"</span><span class="p">);</span>
    
    <span class="c1">// F0 motor properties</span>
    <span class="n">atp_synthase</span><span class="nf">.set_f0_properties</span><span class="p">(</span><span class="n">F0Properties</span> <span class="p">{</span>
        <span class="n">c_ring_stoichiometry</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>        <span class="c1">// 8 c-subunits</span>
        <span class="n">proton_binding_sites</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>        <span class="c1">// One per c-subunit</span>
        <span class="n">rotational_resistance</span><span class="p">:</span> <span class="mf">1e-21</span><span class="p">,</span>   <span class="c1">// Nm⋅s - rotational friction</span>
        <span class="n">torque_per_proton</span><span class="p">:</span> <span class="mf">40e-21</span><span class="p">,</span>      <span class="c1">// Nm - torque generated per proton</span>
    <span class="p">});</span>
    
    <span class="c1">// F1 motor properties  </span>
    <span class="n">atp_synthase</span><span class="nf">.set_f1_properties</span><span class="p">(</span><span class="n">F1Properties</span> <span class="p">{</span>
        <span class="n">catalytic_sites</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>             <span class="c1">// 3 β subunits</span>
        <span class="n">atp_binding_cooperativity</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="c1">// Hill coefficient</span>
        <span class="n">atp_synthesis_rate</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>      <span class="c1">// s⁻¹ maximum rate</span>
        <span class="n">atp_km</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>                    <span class="c1">// mM</span>
    <span class="p">});</span>
    
    <span class="c1">// Coupling between F0 and F1</span>
    <span class="n">atp_synthase</span><span class="nf">.set_coupling</span><span class="p">(</span><span class="n">F0F1Coupling</span> <span class="p">{</span>
        <span class="n">gear_ratio</span><span class="p">:</span> <span class="mf">8.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span>          <span class="c1">// 8 protons per 3 ATP</span>
        <span class="n">coupling_efficiency</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>       <span class="c1">// 95% mechanical coupling</span>
        <span class="n">slip_rate</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>                <span class="c1">// 1% slip under load</span>
    <span class="p">});</span>
    
    <span class="n">atp_synthase</span>
<span class="p">}</span>

<span class="c1">// Circuit parameter calculation for ATP synthase</span>
<span class="k">impl</span> <span class="n">TransmembraneProteinElectrics</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">calculate_atp_synthase_circuit</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">proton_gradient</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">atp_concentration</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ProteinEquivalentCircuit</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">f0_properties</span> <span class="o">=</span> <span class="k">self</span><span class="py">.f0_properties</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">f1_properties</span> <span class="o">=</span> <span class="k">self</span><span class="py">.f1_properties</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">coupling</span> <span class="o">=</span> <span class="k">self</span><span class="py">.coupling</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        
        <span class="c1">// Calculate driving torque from proton gradient</span>
        <span class="k">let</span> <span class="n">proton_chemical_potential</span> <span class="o">=</span> <span class="mf">2.3</span> <span class="o">*</span> <span class="mf">8.314</span> <span class="o">*</span> <span class="mf">310.0</span> <span class="o">*</span> <span class="n">proton_gradient</span><span class="nf">.log10</span><span class="p">();</span> <span class="c1">// J/mol</span>
        <span class="k">let</span> <span class="n">driving_torque</span> <span class="o">=</span> <span class="n">f0_properties</span><span class="py">.torque_per_proton</span> <span class="o">*</span> <span class="n">f0_properties</span><span class="py">.proton_binding_sites</span><span class="p">;</span>
        
        <span class="c1">// Calculate load torque from ATP synthesis</span>
        <span class="k">let</span> <span class="n">atp_load</span> <span class="o">=</span> <span class="n">f1_properties</span><span class="nf">.calculate_atp_synthesis_load</span><span class="p">(</span><span class="n">atp_concentration</span><span class="p">);</span>
        
        <span class="c1">// Net torque and rotation rate</span>
        <span class="k">let</span> <span class="n">net_torque</span> <span class="o">=</span> <span class="n">driving_torque</span> <span class="o">-</span> <span class="n">atp_load</span> <span class="o">/</span> <span class="n">coupling</span><span class="py">.gear_ratio</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">rotation_rate</span> <span class="o">=</span> <span class="n">net_torque</span> <span class="o">/</span> <span class="n">f0_properties</span><span class="py">.rotational_resistance</span><span class="p">;</span>
        
        <span class="c1">// ATP synthesis rate</span>
        <span class="k">let</span> <span class="n">atp_synthesis_rate</span> <span class="o">=</span> <span class="n">rotation_rate</span> <span class="o">*</span> <span class="n">coupling</span><span class="py">.coupling_efficiency</span> <span class="o">/</span> <span class="n">coupling</span><span class="py">.gear_ratio</span><span class="p">;</span>
        
        <span class="c1">// Equivalent circuit</span>
        <span class="nn">ProteinEquivalentCircuit</span><span class="p">::</span><span class="n">AtpSynthase</span> <span class="p">{</span>
            <span class="n">proton_current</span><span class="p">:</span> <span class="n">rotation_rate</span> <span class="o">*</span> <span class="n">f0_properties</span><span class="py">.c_ring_stoichiometry</span><span class="p">,</span>
            <span class="n">atp_production_rate</span><span class="p">:</span> <span class="n">atp_synthesis_rate</span><span class="p">,</span>
            <span class="n">internal_resistance</span><span class="p">:</span> <span class="k">self</span><span class="nf">.calculate_synthase_internal_resistance</span><span class="p">(),</span>
            <span class="n">torque_constant</span><span class="p">:</span> <span class="n">driving_torque</span> <span class="o">/</span> <span class="n">proton_gradient</span><span class="p">,</span>
            <span class="n">back_emf</span><span class="p">:</span> <span class="n">atp_load</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<p>The <strong>Molecular Layer</strong> provides the fundamental biophysical foundation for all membrane electrical properties, translating lipid-protein interactions, membrane curvature, and electrochemical gradients into the circuit parameters that enable Nebuchadnezzar’s ATP-based differential equation modeling of biological systems.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/bene-gesserit/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Bene Gesserit: Biological Quantum Computing Framework</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">{&quot;name&quot;=&gt;&quot;Bene Gesserit Research Team&quot;, &quot;email&quot;=&gt;&quot;research@bene-gesserit.org&quot;}</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Revolutionary framework combining ATP dynamics, oscillatory entropy, and membrane quantum computation with Turbulance DSL for encoding the scientific method</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
